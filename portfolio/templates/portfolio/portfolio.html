<!DOCTYPE html>
{% extends 'base.html' %}
{% block content %}
{% load static %}
    <main>
        <div>Здесь приделал форму из формы джанго, с возможностью настраивать стили для лейблов и полей</div>
        <form id="new_img_form" class="hero card" action="{% url 'portfolio' %} " method="POST" enctype="multipart/form-data" style="display: none">
            {% csrf_token %}
            <input id="edit_mode" type="text" name="edit_mode" >
            

            {% for field in form %}
            <div class="my_field">
                <label class="my_label" for="{{ field.auto_id }}">{{ field.label }}</label>
                {{ field }}
            </div>
            {% endfor %}

            <button id="submitButton" class="button" type = "submit">Добавить</button>
        </form>
        </section>
    {% if portfolio %}
        <section class="gallery">
        <div id="img_view">
            <img id="main-image" src="" alt="">
            <div id="descriptions">
                <div id="img_title">Название: <span>nazv</span></div>
                <div id="img_desc">Описание: <span>opis</span></div>
                <div id="img_date">Дата: <span>dat</span></div>
                <div id="img_urls">В сотрудничестве: <span>ssilki</span></div>
                <div id="img_id" hidden="hidden">ID: <span>id</span></div>
            </div>
        </div>
        <ul class="thumbs">
        {% for artwork in portfolio %}
<!--            <div class="card">-->
                <li class="thumb__block" href="{{ artwork.url }}">
                    <img class="thumb__img" src="{{ artwork.thumb.url }}" alt="">

                    <span class="tmb_title">{{ artwork.title }}</span>
                    <span class="tmb_desc" hidden="hidden">{{ artwork.desc }}</span>
                    <span class="tmb_date" hidden="hidden">{{ artwork.date }}</span>
                    <span class="tmb_urls" hidden="hidden">{{ artwork.url }}</span>
                    <span class="tmb_id" hidden="hidden">{{ artwork.id }}</span>
<!--                <span class="thumb__txt">{{ artwork.desc|truncatechars:20 }}</span>-->
                </li>
        {% endfor %}
        </ul>
        {% endif %}
        </section>
        <section class="hero">






        <script>
<!--    Просмотр галереи        -->

            function get_date(date)
            {
                let day_list = ['первое', 'второе', 'третье', 'четвёртое',
                    'пятое', 'шестое', 'седьмое', 'восьмое',
                    'девятое', 'десятое', 'одиннадцатое', 'двенадцатое',
                    'тринадцатое', 'четырнадцатое', 'пятнадцатое', 'шестнадцатое',
                    'семнадцатое', 'восемнадцатое', 'девятнадцатое', 'двадцатое',
                    'двадцать первое', 'двадцать второе', 'двадцать третье',
                    'двадацать четвёртое', 'двадцать пятое', 'двадцать шестое',
                    'двадцать седьмое', 'двадцать восьмое', 'двадцать девятое',
                    'тридцатое', 'тридцать первое'];
                let month_list = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня',
                    'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];


                const months = {
                    'Jan.': 'января',
                    'Feb.': 'февраля',
                    "March":'марта',
                    "April":'апреля',
                    "May":'мая',
                    "June":'июня',
                    "July":'июля',
                    "Aug.":'августа',
                    "Sept.":'сентября',
                    "Oct.":'октября',
                    "Nov.":'ноября',
                    "Dec.":'декабря'
                };


                console.log(date)
                let date_list = date.split(',')
                let year = parseInt(date_list[1])
                console.log(year)
                let day_and_month = date_list[0].split(' ')
                let day = parseInt(day_and_month[1])
                console.log(day)
                let month = day_and_month[0]
                console.log(month)

                return (day_list[day - 1] + ' ' +
                    months[month] + ' ' +
                    year + ' года')

            }

            const mainBlock = document.getElementById('img_view').children;
            const mainImage=mainBlock.namedItem('main-image');
            const mainDescription = mainBlock.namedItem('descriptions').children;
            const mainImage_title=mainDescription.namedItem('img_title').children.item(0);
            const mainImage_desc=mainDescription.namedItem('img_desc').children.item(0);
            const mainImage_date=mainDescription.namedItem('img_date').children.item(0);
            const mainImage_urls=mainDescription.namedItem('img_urls').children.item(0);

            const mainImage_id=mainDescription.namedItem('img_id').children.item(0);



            const thumbBlocks = document.querySelectorAll('.thumb__block');
            const firstThumbBlockContent = thumbBlocks[0];
            const thumbnail = firstThumbBlockContent.getElementsByTagName('img')[0]
            const descriptions = firstThumbBlockContent.getElementsByTagName('span');

            const title = descriptions[0];
            const desc = descriptions[1];
            const date = descriptions[2];
            const urls = descriptions[3];

            const img_id = descriptions[4];

            mainImage.src = thumbnail.src;
            mainImage.alt = thumbnail.alt;

            mainImage_title.textContent = title.textContent;
            mainImage_desc.textContent = desc.textContent;
            mainImage_date.textContent = get_date(date.textContent);
            mainImage_urls.textContent = urls.textContent;

            mainImage_id.textContent = img_id.textContent;

            thumbnail.classList.toggle('active');
            let old_active=thumbnail;


                thumbBlocks.forEach(thumbBlock =>
                {


                    thumbBlock.addEventListener('click', (event) =>
                    {
                        const target = event.target;
                        if (target.tagName === 'IMG')
                        {
                            // thumbBlock.classList.toggle('active', target === thumbBlock.firstElementChild);
                            target.classList.toggle('active');
                            old_active.classList.toggle('active');
                            old_active = target;
                        }


                        const image = thumbBlock.getElementsByTagName('img')[0];
                        const descriptions = thumbBlock.getElementsByTagName('span');
                        const title = descriptions[0];
                        const desc = descriptions[1];
                        const date = descriptions[2];
                        const urls = descriptions[3];
                        const img_id = descriptions[4];
                        mainImage.src = image.src;
                        mainImage.alt = image.alt;

                        mainImage_title.textContent = title.textContent;
                        mainImage_desc.textContent = desc.textContent;
                        mainImage_date.textContent=get_date(date.textContent);
                        mainImage_urls.textContent=urls.textContent;
                        mainImage_id.textContent=img_id.textContent;
                    });
                });

        </script>
        <script>
            const imgEditMode = document.getElementById('edit_mode');
            const newImgForm = document.getElementById('new_img_form');
            const textFields = newImgForm.getElementsByClassName('txt-input');

            const imageField = document.getElementById('img_file');
            const titleField = textFields.namedItem('title');
            const descField = textFields.namedItem('desc');
            const dateField = textFields.namedItem('date');
            const urlsField = textFields.namedItem('url');


            const submitBtn = document.getElementById("submitButton");
            // imageField.required=false;
            // titleField.required=false;
            descField.required=false;
            dateField.required=false;
            urlsField.required=false;


            let header = document.getElementsByClassName('header-right')[0];
            const button = document.createElement('button');
            button.innerHTML = 'Добавить';
            header.appendChild(button);
            button.addEventListener("click", () =>
            {
                imgEditMode.value="new_image";
                imageField.required=true;
                titleField.required=true;
                // descField.required=true;
                // dateField.required=true;
                // urlsField.required=true;


                titleField.value="";
                descField.value="";
                dateField.value="";
                urlsField.value="";
                idField.value="";
                if (newImgForm.style.display == 'none')
                {
                    newImgForm.style.display='flex';
                    newImgForm.style.zIndex='var(--max-z-index)';
                    submitBtn.innerHTML="Отправить"
                }
                else
                {
                  newImgForm.style.display='none';
                  newImgForm.style.zIndex='-1';
                }


            });
        </script>
        <script>

            // const editImgForm = document.getElementById('new_img_form');
            // let header = document.getElementsByClassName('header-right')[0];
            let editbutton = document.createElement('button');
            const idField = textFields.namedItem('id');
            editbutton.innerHTML = 'Редактировать';
            header.appendChild(editbutton);
            editbutton.addEventListener("click", () =>
            {
                imgEditMode.value="edit_image";
                imageField.required=false;
                titleField.required=true;
                // newImgForm.children.namedItem('')
                // const textFields = newImgForm.getElementsByClassName('txt-input')
                // const title = textFields.namedItem('title')
                // const desc = textFields.namedItem('desc')
                // const date = textFields.namedItem('date')
                // const urls = textFields.namedItem('url')

                titleField.value=mainImage_title.textContent;
                descField.value=mainImage_desc.textContent;
                dateField.value=mainImage_date.textContent;
                urlsField.value=mainImage_urls.textContent;
                idField.value=mainImage_id.textContent;



                if (newImgForm.style.display == 'none')
                {
                    newImgForm.style.display='flex';
                    newImgForm.style.zIndex='var(--max-z-index)';
                    submitBtn.innerHTML="Сохранить"


                }
                else
                {
                  newImgForm.style.display='none';
                  newImgForm.style.zIndex='-1';
                }


            });
        </script>
        <script>
            const deletebutton = document.createElement('button');

            deletebutton.innerHTML = 'Удалить';
            header.appendChild(deletebutton);
            deletebutton.addEventListener("click", () =>
            {
                imageField.required=false;
                titleField.required=false;
                imgEditMode.value="delete_image";
                submitBtn.innerHTML="Удалить"
                idField.value=mainImage_id.textContent;
                submitBtn.click();
                // imageField.required=true;
                // titleField.required=true;

            });
        </script>
    </main>
{% endblock %}
